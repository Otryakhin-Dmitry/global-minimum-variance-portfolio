---
title: "An introduction to hdsp package with examples."
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo = FALSE}
library(HDShOP)
```

## Overview
This package is implementation of various shrinkage techniques with application to the so-called expected utility portfolios. It contains three main functions: EUShrinkPortfolio, CovarEstim and MeanEstim. 

The following setup will be used throughout all examples:
```{r experiment setup}

n<-3e2 # number of realizations
p<-.5*n # number of assets
gamma<-1

# the target for covariance shrinkage
TM <- matrix(0, p, p) 
diag(TM) <- 1

# the target for shrinkage of the mean vector
mu_0 <- rep(0, p)
mu_0[1:10] <- 10:1
```

All data matrices in the package are handled in a way that the variables are in rows and observations- in columns.
```{r}
x <- matrix(data = rnorm(n*p), nrow = p, ncol = n) # asset returns
```

## EU Portfolios
The general function performing portfolio creation is EUShrinkPortfolio. Essentially, it is a function dispatcher which chooses a method according to arguments type and subtype. It returns either a portfolio in the form of ExUtil_portfolio S3 class or a human-readable error message. Argument type represents the type of shrinkage to use, while subtype is a particular method. EUShrinkPortfolio should be used in interactive programming as it is more user-friendly and slower than underlying methods, while methods themselves should be exploited for writing more complicated but at the same time efficient and fast code.

### EU portfolio with shrinked weights

Weight-shrinked portfolio from [IEEE2020] is constructed by setting type='weights'. Subtype argument is not set since the method is the only one of its type implemented.
```{r}
portfolio <- EUShrinkPortfolio(x=x, gamma=gamma, type='weights', b=rep(1/p,p))
str(portfolio)
```



## Shrinkage estimators for covariance matrix
The next important function is CovarEstim. This is a dispatcher for functions computing the covariance matrix of the data.
```{r}
Mtrx_naive <- CovarEstim(x, type="naive")
# Mtrx_naive[1:6,1:6]
format(Mtrx_naive[1:6,1:6], scientific = TRUE, digits = 3)
```

```{r}
Mtrx_bgp <- CovarEstim(x, type="BGP14", TM=TM, SCM=Mtrx_naive)
# Mtrx_bgp[1:6,1:6]
format(Mtrx_bgp[1:6,1:6], scientific = TRUE, digits = 3)
```


## Shrinkage estimators for mean vectors

```{r}
Mean_BOP <- MeanEstim(x, type="BOP19", mu_0=mu_0)
head(Mean_BOP)
```

## Custom mean-variance portfolios
It is possible to make custom mean-variance portfolios having pre-specified mean values of returns and their covariance matrix.
```{r}
TM <- matrix(0, nrow=p, ncol=p)
diag(TM) <- 1/p

SCM <- Sigma_sample_estimator(x)

Sigma_shr <- CovShrinkBGP14(n=n, TM=TM, SCM=SCM)

means <- mean_bop19(x=x, mu_0=mu_0)

cust_port_BS_LW <- new_MeanVar_portfolio(mean_vec=means$means, 
                                         cov_mtrx=Sigma_shr$S, gamma=2)
str(cust_port_BS_LW)
```

HDShOP includes three functions related to this purpose: new_MeanVar_portfolio which is a constructor of objects of class MeanVar_portfolio, validation function for such objects validate_MeanVar_portfolio and helper MeanVar_portfolio. Conventionally, the constructor is a raw creator of objects of the class: it takes arguments mean_vec, cov_mtrx, gamma and computes weights accordingly to the formula. The validator runs checks designed to verify if the object at hand is a legitimate object of class MeanVar_portfolio, while helper is a combination of the two. Currently, validate_MeanVar_portfolio checks if all the necessary slots are present in the object, its weight and mean vectors have the same length as the number of rows in the covariance matrix and that the covariance matrix is square.
